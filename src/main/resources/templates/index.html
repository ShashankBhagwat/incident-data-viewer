<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dynamic DB Viewer</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<h2>Select Tables</h2>

<form action="query" method="post" onsubmit="return validateSelection()">

    <div class="dropdown-checkbox">

        <div class="dropdown-header" onclick="toggleDropdown()">
            Select Tables â–¼
        </div>

        <div class="dropdown-content" id="dropdownBox">

            <label class="checkbox-item" th:each="t : ${tables}">
                <input type="checkbox"
                       name="selectedTables"
                       th:value="${t}"
                       class="table-checkbox"
                       th:checked="${selectedTables != null and selectedTables.contains(t)}">

                <span th:text="${t}"></span>
            </label>

        </div>
    </div>

    <br/>
    <button type="submit" class="btn-primary">Fetch Data</button>
</form>

<div class="action-bar">

    <!-- Incident ID -->
    <div class="incident-box">
        <label for="incidentId">Incident ID</label>
        <input type="text" id="incidentId" name="incidentId" placeholder="Enter ID">
    </div>

    <!-- CSV Button -->
    <form action="/download" method="post" id="downloadForm" onsubmit="copyIncidentId()">
        <input type="hidden" name="jsonData" id="jsonDataField" th:value="${resultJson}">
        <input type="hidden" name="incidentId" id="incidentIdHidden1">
        <button type="submit" id="csvBtn" class="btn download-btn">CSV</button>
    </form>

    <!-- Excel Button -->
    <form action="/downloadExcel" method="post" id="downloadExcelForm" onsubmit="copyIncidentId()">
        <input type="hidden" name="jsonData" id="jsonDataFieldExcel" th:value="${resultJson}">
        <input type="hidden" name="incidentId" id="incidentIdHidden2">
        <button type="submit" id="excelBtn" class="btn download-btn excel-btn">Excel</button>
    </form>

</div>

<hr/>

<div th:if="${result}">
    <div th:each="tableData : ${result}">
        <h3 th:text="'Table: ' + ${tableData.tableName}"></h3>

        <table th:if="${#lists.size(tableData.rows) > 0}" border="1">
            <thead>
            <tr>
                <th th:each="col : ${tableData.columns}" th:text="${col}"></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="row : ${tableData.rows}">
                <td th:each="col : ${tableData.columns}" th:text="${row.get(col)}"></td>
            </tr>
            </tbody>
        </table>

        <div th:if="${#lists.size(tableData.rows) == 0}" style="color: #999; font-style: italic;">
            No data found in this table.
        </div>

        <br/>
    </div>
</div>

<script th:src="@{/js/dropdown.js}"></script>
</body>
</html>
